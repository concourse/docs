<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=775" />
<title>Common Pipeline Practices - Concourse CI</title>
<link rel="stylesheet" type="text/css" href="css/normalize.css" />
<link rel="stylesheet" type="text/css" href="css/pipeline.css" />
<link rel="stylesheet" type="text/css" href="css/iosevka.css" />
<link rel="stylesheet" type="text/css" href="css/booklit.css" />
<link rel="stylesheet" type="text/css" href="css/prism.css" />
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
<link href="https://fonts.googleapis.com/css?family=Barlow:400,400i,700|Roboto+Slab:300,400,700" rel="stylesheet" />
<script src="js/search.js"></script>
<script async type="text/javascript" src="js/prism.js"></script>
<script data-goatcounter="https://concourse.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
  </head>
  <body>
    

<div class="page-top">
  <nav class="top-nav">
    <a class="top-link logo-link" href="/"><img src="images/logo-white.svg" />Concourse</a>
    
    <a class="top-link active" href="docs.html">Docs</a>
    
    <a class="top-link" href="examples.html">Examples</a>
    
    <a class="top-link" href="project.html">Project</a>
    
    <a class="top-link" href="ecosystem.html">Ecosystem</a>
    
    <a class="top-link" href="support.html">Support</a>
    
    <a class="top-link" href="https://resource-types.concourse-ci.org">Resource Types</a>
    <a class="top-link" href="https://blog.concourse-ci.org">blog</a>

    <div id="search"></div>

    <script type="text/javascript">
      var app = Elm.Main.init({
        node: document.getElementById('search')
      });

      app.ports.emitSearchTerm.subscribe(function(term) {
        goatcounter.count({
          path: "search:" + term,
          title: "user searched: " + term,
          event: true
        });
      });
    </script>
  </nav>
</div>

    <div class="page-body">
      <div class="page-nav">
        






  
  
  
  
  
  
  

  
  <div class="context">
    <nav>
      <div class="top">
        <span class="section-number">1</span><a href="docs.html"  class="active">Docs</a>
      </div>

      <div class="children">
        <table>
        
          <tr>
            <td class="number-cell">1.1</td>
            <td class="title-cell"><a href="getting-started.html" >Getting Started</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.2</td>
            <td class="title-cell"><a href="install.html" >Install</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.3</td>
            <td class="title-cell"><a href="auth.html" >Auth &amp; Teams</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.4</td>
            <td class="title-cell"><a href="fly.html" >The <code>fly</code> CLI</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.5</td>
            <td class="title-cell"><a href="config-basics.html" >Config Basics</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.6</td>
            <td class="title-cell"><a href="pipelines.html" >Pipelines</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.7</td>
            <td class="title-cell"><a href="vars.html" >Vars</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.8</td>
            <td class="title-cell"><a href="resources.html" >Resources</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.9</td>
            <td class="title-cell"><a href="resource-types.html" >Resource Types</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.10</td>
            <td class="title-cell"><a href="jobs.html" >Jobs</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.11</td>
            <td class="title-cell"><a href="steps.html" >Steps</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.12</td>
            <td class="title-cell"><a href="tasks.html" >Tasks</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.13</td>
            <td class="title-cell"><a href="builds.html" >Builds</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.14</td>
            <td class="title-cell"><a href="how-to-guides.html"  class="active">How-To Guides</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15</td>
            <td class="title-cell"><a href="operation.html" >Operation</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.16</td>
            <td class="title-cell"><a href="observation.html" >Observation</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.17</td>
            <td class="title-cell"><a href="internals.html" >Internals</a></td>
          </tr>
        
        </table>
      </div>
    </nav>
  </div>
  

  

  
  <div class="context">
    <nav>
      <div class="top">
        <span class="section-number">1.14</span><a href="how-to-guides.html"  class="active">How-To Guides</a>
      </div>

      <div class="children">
        <table>
        
          <tr>
            <td class="number-cell">1.14.1</td>
            <td class="title-cell"><a href="pipeline-guides.html"  class="active">Pipeline Guides</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.14.2</td>
            <td class="title-cell"><a href="git-guides.html" >Git Guides</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.14.3</td>
            <td class="title-cell"><a href="container-image-guides.html" >Container Image Guides</a></td>
          </tr>
        
        </table>
      </div>
    </nav>
  </div>
  

  

  
  <div class="context">
    <nav>
      <div class="top">
        <span class="section-number">1.14.1</span><a href="pipeline-guides.html"  class="active">Pipeline Guides</a>
      </div>

      <div class="children">
        <table>
        
          <tr>
            <td class="number-cell">1.14.1.1</td>
            <td class="title-cell"><a href="common-pipeline-practices.html"  class="self">Common Pipeline Practices</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.14.1.2</td>
            <td class="title-cell"><a href="exploring-task-input-and-output-scenarios.html" >Exploring Task Input and Output Scenarios</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.14.1.3</td>
            <td class="title-cell"><a href="gated-pipeline-patterns.html" >Gated Pipeline Patterns</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.14.1.4</td>
            <td class="title-cell"><a href="time-triggered-pipeline-patterns.html" >Time Triggered Pipeline Patterns</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.14.1.5</td>
            <td class="title-cell"><a href="manual-approval-step.html" >Manual Approval Step</a></td>
          </tr>
        
        </table>
      </div>
    </nav>
  </div>
  

  

  



      </div>

      <div class="body-content">
        <div class="page-content">
          <div class="section" id="section_common-pipeline-practices">
  
  <h1 class="section-header"><a class="anchor-target" name="common-pipeline-practices" href="#common-pipeline-practices"></a><span class="section-number">1.14.1.1 </span>Common Pipeline Practices</h1>
  

  <p>The following are practices that we see a lot of people use in their pipelines. These are by no means &#34;Best&#34; practices, they are simply common and may or may not work for you and your team.</p>

  
    
      <div class="section" id="section_parallelizing-get-steps-in-jobs">
  
  <h2 class="section-header"><a class="anchor-target" name="parallelizing-get-steps-in-jobs" href="#parallelizing-get-steps-in-jobs"></a>Parallelizing Get Steps in Jobs</h2>
  

  <p>All jobs usually have <a href="get-step.html">get steps</a> as their first set of steps.</p><pre><code class="language-yaml">jobs:
- name: awesome-job
  plan:
  - get: cool-code
  - get: funny-binary
  - get: the-weather
  - task: business-stuff</code></pre><p>To reduce the waiting time to the length of the longest running get step, put all get steps under an <a href="in-parallel-step.html"><code>in_parallel</code> step</a>.</p><pre><code class="language-yaml">jobs:
- name: awesome-job
  plan:
  - in_parallel:
    - get: cool-code
    - get: funny-binary
    - get: the-weather
  - task: business-stuff</code></pre>

  
    
  
</div>
    
      <div class="section" id="section_specify-inputs-for-put-steps">
  
  <h2 class="section-header"><a class="anchor-target" name="specify-inputs-for-put-steps" href="#specify-inputs-for-put-steps"></a>Specify Inputs for Put Steps</h2>
  

  <p>By default <a href="put-step.html"><code>put</code> step</a>&#39;s have all artifacts from a job mounted in their resource container. This can result in long initialization times for put steps. It&#39;s likely that a <a href="put-step.html"><code>put</code> step</a> only needs a subset of all available artifacts generated throughout the job.</p><p>There are two ways to specify which artifacts to send to a <a href="put-step.html"><code>put</code> step</a>. You can specify <code>detect</code> as the <a href="put-step.html#schema.put.inputs"><code>put</code> step <strong><code>inputs</code></strong></a> or you can pass in an exact list of all artifacts the <a href="put-step.html"><code>put</code> step</a> needs.</p><p>Using <code>detect</code>: <pre><code class="language-yaml">jobs:
- name: the-job
  plan: # Get some artifacts
  - in_parallel:
    - get: apples
    - get: apple-basket
    - get: monkeys
  # using detect will result in &#34;apples-location&#34; and &#34;basket&#34; being passed in
  # &#34;monkeys&#34; will not be passed in
  - put: apples-in-basket
    inputs: detect
    params:
      apples-location: apples/location # matches the first get step
      basket: apple-basket # matches the second get step</code></pre></p><p>Specifying the exact inputs needed for the <a href="put-step.html"><code>put</code> step</a>: <pre><code class="language-yaml">jobs:
- name: the-job
  plan: # Get some artifacts
  - in_parallel:
    - get: apples
    - get: apple-basket
    - get: monkeys
  - put: apples-in-basket
    inputs: [apples, apple-basket] # specify the exact inputs needed
    params:
      apples-location: apples/location
      basket: apple-basket</code></pre></p>

  
    
  
</div>
    
      <div class="section" id="section_putting-task-configs-in-files">
  
  <h2 class="section-header"><a class="anchor-target" name="putting-task-configs-in-files" href="#putting-task-configs-in-files"></a>Putting Task Configs in Files</h2>
  

  <p>A lot of the pipeline examples that you will find on this site and in resource repos will embed a <a href="task-step.html#schema.task.config"><code>task</code> step <strong><code>config</code></strong></a> directly in the pipeline. This is a nice way of clearly seeing what inputs/outputs the task uses. Tasks are usually designed to be used in multiple places, maybe with slightly different configuration. To support this scenario, most users store task configs in files instead of embedding the config directly in the pipeline.</p><p>Here&#39;s what this looks like in practice:</p><p><div class="titled-codeblock">
  <div class="codeblock-title">
    <code>print-date.yml, stored in some git repo under a folder named &#34;tasks&#34;</code>
  </div>

  <pre><code class="language-yaml">platform: linux

image_resource: # define a default image for the task to use
  type: registry-image
  source:
    repository: busybox

run:
  path: date
  args: [&#34;&#43;%Y-%m-%d&#34;]</code></pre>
</div> <div style="margin: 0 2em 1em" class="inset"></div></p><p>Using the task in a pipeline:</p><div class="titled-codeblock">
  <div class="codeblock-title">
    <code>pipeline.yml</code>
  </div>

  <pre><code class="language-yaml">resources:
- name: ci
  type: git
  source:
    uri: https://github.com/concourse/examples.git

jobs:
- name: the-best-job
  plan:
  - get: ci
  - task: today
    file: ci/tasks/print-date.yml</code></pre>
</div>

  
    
  
</div>
    
      <div class="section" id="section_get-images-for-tasks-instead-of-using-anonymous-image-resources">
  
  <h2 class="section-header"><a class="anchor-target" name="get-images-for-tasks-instead-of-using-anonymous-image-resources" href="#get-images-for-tasks-instead-of-using-anonymous-image-resources"></a><code>Get</code> Images for Tasks Instead of using Anonymous Image Resources</h2>
  

  <p>It is easy to let Concourse fetch images for tasks right when they are needed by using the <a href="tasks.html#schema.task-config.image_resource"><code class="schema-attribute-name"><bold>task-config<wbr />.image_resource</bold></code></a> field in a <a href="tasks.html">task config</a>. It&#39;s the easy out-of-the-box solution. Another way is to pass the image for a task as an input to the job by setting the <a href="task-step.html#schema.task.image"><code>task</code> step <strong><code>image</code></strong></a> field. This also allows you to track the version of the image being used by the task and also avoid getting rate-limited by configuring the resource with credentials.</p><p><strong>Before - Anonymous Image Fetching for Tasks</strong></p><pre><code class="language-yaml">jobs:
- name: job
  plan:
  - task: simple-task
    config:
      platform: linux
      image_resource: # anonymous image resource
        type: registry-image
        source:
          repository: busybox
      run:
        path: echo
        args: [&#34;Hello world!&#34;]</code></pre><p><div style="margin: 0 2em 1em" class="inset"></div></p><p><strong>After - Passing Task Image as Job Inputs</strong></p><pre><code class="language-yaml">resources:
- name: busybox
  type: registry-image
  source:
    repository: busybox
    username: ((docker.user))
    password: ((docker.password))

jobs:
- name: job
  plan:
  - get: busybox # pass image into job
  - task: simple-task
    image: busybox # use image for task. Overrides anonymous image
    config:
      platform: linux
      run:
        path: echo
        args: [&#34;Hello world!&#34;]</code></pre>

  
    
  
</div>
    
  
</div>

          <nav class="prev-next">
          
            <div class="prev">
              prev:

              
              <span class="section-number">1.14.1</span>
              

              <a href="pipeline-guides.html">Pipeline Guides</a>
            </div>
          

          
            <div class="next">
              next:

              
              <span class="section-number">1.14.1.2</span>
              

              <a href="exploring-task-input-and-output-scenarios.html">Exploring Task Input and Output Scenarios</a>
            </div>
          
          </nav>
        </div>

        <div class="page-aside"></div>
      </div>
    </div>

    <ul class="improve-docs">
      <li><img src="images/icons/github-box.svg" /> <a href="https://github.com/concourse/docs">help improve this site</a></li>
      <li><img src="images/booklit.svg" /> powered by <a href="https://vito.github.io/booklit">Booklit</a></li>
    </ul>
  </body>
</html>