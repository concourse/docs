<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=775" />
<title>Grouping Pipelines - Concourse CI</title>
<link rel="stylesheet" type="text/css" href="css/normalize.css" />
<link rel="stylesheet" type="text/css" href="css/pipeline.css" />
<link rel="stylesheet" type="text/css" href="css/iosevka.css" />
<link rel="stylesheet" type="text/css" href="css/booklit.css" />
<link rel="stylesheet" type="text/css" href="css/prism.css" />
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
<link href="https://fonts.googleapis.com/css?family=Barlow:400,400i,700|Roboto+Slab:300,400,700" rel="stylesheet" />
<script src="js/search.js"></script>
<script async type="text/javascript" src="js/prism.js"></script>
<script data-goatcounter="https://concourse.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
  </head>
  <body>
    <div class="top-banner">
  <p class="banner-text">
    ✨ The <a href="https://airtable.com/shrp01n9DwRSIz4vk">2021 Concourse CI Community Survey</a> is now live! ✨
  </p>
</div>

<div class="page-top">
  <nav class="top-nav">
    <a class="top-link logo-link" href="/"><img src="images/logo-white.svg" />Concourse</a>
    
    <a class="top-link active" href="docs.html">Docs</a>
    
    <a class="top-link" href="examples.html">Examples</a>
    
    <a class="top-link" href="project.html">Project</a>
    
    <a class="top-link" href="ecosystem.html">Ecosystem</a>
    
    <a class="top-link" href="https://resource-types.concourse-ci.org">Resource Types</a>
    <a class="top-link" href="https://blog.concourse-ci.org">blog</a>
    <a class="top-link" href="https://github.com/concourse/concourse/discussions">discuss</a>

    <div id="search"></div>

    <script type="text/javascript">
      var app = Elm.Main.init({
        node: document.getElementById('search')
      });

      app.ports.emitSearchTerm.subscribe(function(term) {
        goatcounter.count({
          path: "search:" + term,
          title: "user searched: " + term,
          event: true
        });
      });
    </script>
  </nav>
</div>

    <div class="page-body">
      <div class="page-nav">
        






  
  
  
  
  

  
  <div class="context">
    <nav>
      <div class="top">
        <span class="section-number">1</span><a href="docs.html"  class="active">Docs</a>
      </div>

      <div class="children">
        <table>
        
          <tr>
            <td class="number-cell">1.1</td>
            <td class="title-cell"><a href="install.html" >Install</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.2</td>
            <td class="title-cell"><a href="auth.html" >Auth &amp; Teams</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.3</td>
            <td class="title-cell"><a href="fly.html" >The <code>fly</code> CLI</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.4</td>
            <td class="title-cell"><a href="config-basics.html" >Config Basics</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.5</td>
            <td class="title-cell"><a href="pipelines.html"  class="active">Pipelines</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.6</td>
            <td class="title-cell"><a href="vars.html" >Vars</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.7</td>
            <td class="title-cell"><a href="resources.html" >Resources</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.8</td>
            <td class="title-cell"><a href="resource-types.html" >Resource Types</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.9</td>
            <td class="title-cell"><a href="jobs.html" >Jobs</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.10</td>
            <td class="title-cell"><a href="tasks.html" >Tasks</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.11</td>
            <td class="title-cell"><a href="builds.html" >Builds</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.12</td>
            <td class="title-cell"><a href="how-to-guides.html" >How-To Guides</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.13</td>
            <td class="title-cell"><a href="operation.html" >Operation</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.14</td>
            <td class="title-cell"><a href="observation.html" >Observation</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15</td>
            <td class="title-cell"><a href="internals.html" >Internals</a></td>
          </tr>
        
        </table>
      </div>
    </nav>
  </div>
  

  

  
  <div class="context">
    <nav>
      <div class="top">
        <span class="section-number">1.5</span><a href="pipelines.html"  class="active">Pipelines</a>
      </div>

      <div class="children">
        <table>
        
          <tr>
            <td class="number-cell">1.5.1</td>
            <td class="title-cell"><a href="setting-pipelines.html" >Setting Pipelines</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.5.2</td>
            <td class="title-cell"><a href="managing-pipelines.html" >Managing Pipelines</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.5.3</td>
            <td class="title-cell"><a href="instanced-pipelines.html"  class="self">Grouping Pipelines</a></td>
          </tr>
        
        </table>
      </div>
    </nav>
  </div>
  

  

  
  <div class="context">
    <nav>
      <div class="top">
        <span class="section-number">1.5.3</span><a href="instanced-pipelines.html"  class="self">Grouping Pipelines</a>
      </div>

      <div class="children">
        <table>
        
          <tr>
            <td class="number-cell">1.5.3.1</td>
            <td class="title-cell"><a href="instanced-pipelines.html#managing-instanced-pipelines" >Managing Instanced Pipelines</a></td>
          </tr>
        
        </table>
      </div>
    </nav>
  </div>
  



      </div>

      <div class="body-content">
        <div class="page-content">
          <div class="section" id="section_instanced-pipelines">
  
  <h1 class="section-header"><a class="anchor-target" name="instanced-pipelines" href="#instanced-pipelines"></a><span class="section-number">1.5.3 </span>Grouping Pipelines</h1>
  

  <div class="warning">
  <p>Instanced Pipelines/Instance Groups are currently experimental, and are subject to change.</p><p>To experiment with Instanced Pipelines on your deployment, you need to set the feature flag <code>--enable-pipeline-instances</code> (<code>CONCOURSE_ENABLE_PIPELINE_INSTANCES=true</code>)</p>
</div><p>Although pipelines operate independently of one another, it&#39;s not uncommon to have several pipelines that are highly related, and possibly derived from the same pipeline template. It&#39;s useful to be able to group these pipelines to reduce clutter and improve navigation. For this, Concourse has the concept of Instanced Pipelines and Instance Groups, where an Instance Group composes several related Instanced Pipelines.</p><p>For instance, suppose you support multiple version lines of your software (v1.0.x and v2.0.x, say), and want a pipeline for each version line in order to facilitate delivering patch releases. You create a common pipeline template that uses <a href="vars.html">Vars</a> to specialize each pipeline:</p><pre><code class="language-yaml">resources:
- name: repo
  type: git
  source:
    uri: git@...
    # The only difference between the pipelines is the git branch to use
    branch: release/v((version))

jobs:
- name: test
  plan: [...]

- name: deploy-to-staging
  plan: [...]

- name: release
  plan: [...]</code></pre><p>Before Concourse v7.0.0, you might set multiple pipelines with the version information encoded in the pipeline name, e.g.:</p><pre><code class="language-bash">$ fly -t example set-pipeline \
    --pipeline release-1.0.x \
    --config template.yml \
    --var version=1.0.x
$ fly -t example set-pipeline \
    --pipeline release-2.0.x \
    --config template.yml \
    --var version=2.0.x</code></pre><p>The downside to this approach is that things can get disorganized quickly as the number of pipelines increases, which can make the UI cluttered and hard to navigate. Additionally, not everything can easily be encoded into the pipeline name, especially with the restrictions on <a href="config-basics.html#schema.identifier">identifiers</a> - while it&#39;s readable in this case, it can get unwieldy as the number of variables in the template grows.</p><p>The recommended approach is to construct an Instance Group where each version has its own Instanced Pipeline:</p><pre><code class="language-bash">$ fly -t example set-pipeline \
    --pipeline release \
    --config template.yml \
    --instance-var version=1.0.x
$ fly -t example set-pipeline \
    --pipeline release \
    --config template.yml \
    --instance-var version=2.0.x</code></pre><p>There are only a few differences from the previous approach in terms of creating the pipelines:</p><ol>

  <li><p>We give each Instanced Pipeline the same name (in this case, <code>release</code>), and</p></li>

  <li><p>We use the <code>--instance-var</code> flag instead of <code>--var</code>. Doing so makes the variable name and value a part of the pipeline&#39;s identifier (<a href="instanced-pipelines.html#managing-instanced-pipelines">Managing Instanced Pipelines</a> describes how to work with Instanced Pipelines in <a href="fly.html">fly</a>)</p></li>

</ol><p><div class="warning">
  The <code>-i</code> or <code>--instance-var</code> flag behaves like the <code>-y</code> or <code>--yaml-var</code>, meaning instance vars can hold arbitrary YAML/JSON data. The <code>v</code> or <code>--var</code> flag, on the other hand, only defines strings. See <a href="vars.html#static-vars">Static vars</a> to learn the difference between the flags
</div></p><p>Note that there are no <a href="fly.html">fly</a> commands for constructing an Instance Group - Concourse logically groups all Instanced Pipelines with the same name into a single Instance Group. Instanced Pipelines have the same pipeline semantics as other pipelines - they are just organized and identified in a different way.</p>

  
    
      <div class="section" id="section_managing-instanced-pipelines">
  
  <h2 class="section-header"><a class="anchor-target" name="managing-instanced-pipelines" href="#managing-instanced-pipelines"></a>Managing Instanced Pipelines</h2>
  

  <p>Instanced Pipelines can be managed via <a href="fly.html">fly</a> as described in <a href="managing-pipelines.html">Managing Pipelines</a>, with one important distinction - since instance vars are a part of the pipeline&#39;s identifier, the <code>--pipeline</code> flag must include both the name of the Instance Group as well as the instance vars. The <code>--pipeline</code> flag takes the form:</p><pre>--pipeline group/var1:value1,var2:value2</pre><p>As a concrete example, to pause the <code>release</code> Instanced Pipeline with <code>version:1.0.x</code>, you would issue the following command:</p><pre><code class="language-bash">$ fly -t example pause-pipeline --pipeline release/version:1.0.x</code></pre><p>Let&#39;s look at a more complicated example - suppose you have an Instanced Pipeline that was set using one of the following commands:</p><pre><code class="language-bash">$ fly -t example set-pipeline \
    --pipeline upgrade \
    --config template.yml \
    --instance-var version.from=1.0.0 \
    --instance-var version.to=2.0.0 \
    --instance-var branch=feature/foo
# ...or equivalently
$ fly -t example set-pipeline \
    --pipeline upgrade \
    --config template.yml \
    --instance-var &#39;version={from: 1.0.0, to: 2.0.0}&#39; \
    --instance-var branch=feature/foo</code></pre><div class="warning">
  <p>Using dot-notation here (as in the first command) is recommended since YAML is finicky about spaces.</p><p>For instance, had we used <code>--instance-var &#39;version={from:1.0.0, to:2.0.0}&#39;</code> (no spaces between keys and values), we would end up with the following object (represented as JSON):</p><p><pre><code class="language-json">{&#34;from:1.0.0&#34;: null, &#34;to:2.0.0&#34;: null}</code></pre></p><p>Specifying each field individually using dot-notation is harder to mess up.</p>
</div><p>Here, there are two instance vars: <code>version</code>, that contains the object <code>{&#34;from&#34;: &#34;1.0.0&#34;, &#34;to&#34;: &#34;2.0.0&#34;}</code>, and <code>branch</code>, that contains the string <code>&#34;feature/foo&#34;</code>. In order to pause this pipeline, you could issue one of the following commands:</p><p><pre><code class="language-bash">$ fly -t example pause-pipeline \
    --pipeline &#39;upgrade/version.from:1.0.0,version.to:2.0.0,branch:&#34;feature/foo&#34;&#39;
# ... or equivalently
$ fly -t example pause-pipeline \
    --pipeline &#39;upgrade/version:{from: 1.0.0, to: 2.0.0},branch:&#34;feature/foo&#34;&#39;</code></pre> For accessing sub-fields of an object, we can either use dot-notation as described in <a href="setting-pipelines.html#pipeline-static-vars">Providing static values for vars</a>, or we can define the object in full as valid YAML.</p><div class="warning">
  <p>If the instance var name or value contains a &#34;special character&#34; (<code>.</code>, <code>,</code>, <code>/</code>, <code>{</code>, <code>}</code>, or whitespace), it must be surrounded by double quotes <code>&#34;</code>.  Depending on your shell, this usually means the entire flag must be quoted, since otherwise your shell will try to expand the quotes.</p>
</div>

  
    
      <div class="section" id="section_fly-order-instanced-pipelines">
  
  <h3 class="section-header"><a class="anchor-target" name="fly-order-instanced-pipelines" href="#fly-order-instanced-pipelines"></a><code>fly order-instanced-pipelines</code></h3>
  

  <p>To configure the ordering of instanced pipelines within an individual instance group, run:</p><pre><code class="language-bash">$ fly -t example order-instanced-pipelines \
    --group group \
    --pipeline key1:value1 \
    --pipeline key2:value2 \
    --pipeline key3:value3</code></pre><p>Note that this command only ensures that the given pipelines are in the given order. If there are other pipelines that you haven&#39;t included in the command, they may appear in-between, before, or after the given set.</p><div class="warning">
  <p>If you want to reorder pipelines outside of an individual instance group, you should use the <a href="managing-pipelines.html#fly-order-pipelines"><code>fly order-pipelines</code></a> command.</p>
</div>

  
    
  
</div>
    
      <div class="section" id="section_jobs-and-resources-instanced-pipelines">
  
  <h3 class="section-header"><a class="anchor-target" name="jobs-and-resources-instanced-pipelines" href="#jobs-and-resources-instanced-pipelines"></a>Managing Jobs and Resources</h3>
  

  <p><a href="jobs.html#managing-jobs">Managing Jobs</a> and <a href="managing-resources.html">Managing Resources</a> walk you through some of the commands you can use to manage jobs and resources within pipelines. For Instanced Pipelines, we need to encode the instance vars in the <code>--job</code> and <code>--resource</code> flags. These flags now take the form:</p><pre>--job group/var1:value1,var2:value2/job</pre><p>and:</p><pre>--resource group/var1:value1,var2:value2/resource</pre><p>For instance, to trigger the <code>test</code> job of <code>release/version:1.0.x</code>, we issue the following command:</p><pre><code class="language-bash">$ fly -t example trigger-job --job release/version:1.0.x/test</code></pre><p>To check the <code>repo</code> resource of <code>release/version:1.0.x</code>, we issue the following command:</p><pre><code class="language-bash">$ fly -t example check-resource --resource release/version:1.0.x/repo</code></pre>

  
    
  
</div>
    
  
</div>
    
  
</div>

          <nav class="prev-next">
          
            <div class="prev">
              prev:

              
              <span class="section-number">1.5.2</span>
              

              <a href="managing-pipelines.html">Managing Pipelines</a>
            </div>
          

          
            <div class="next">
              next:

              
              <span class="section-number">1.6</span>
              

              <a href="vars.html">Vars</a>
            </div>
          
          </nav>
        </div>

        <div class="page-aside"></div>
      </div>
    </div>

    <ul class="improve-docs">
      <li><img src="images/icons/github-box.svg" /> <a href="https://github.com/concourse/docs">help improve this site</a></li>
      <li><img src="images/booklit.svg" /> powered by <a href="https://vito.github.io/booklit">Booklit</a></li>
    </ul>
  </body>
</html>