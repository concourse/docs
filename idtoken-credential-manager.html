<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=775" />
<title>The IDToken credential manager - Concourse CI</title>
<link rel="stylesheet" type="text/css" href="css/normalize.css" />
<link rel="stylesheet" type="text/css" href="css/pipeline.css" />
<link rel="stylesheet" type="text/css" href="css/iosevka.css" />
<link rel="stylesheet" type="text/css" href="css/booklit.css" />
<link rel="stylesheet" type="text/css" href="css/prism.css" />
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
<link href="https://fonts.googleapis.com/css?family=Barlow:400,400i,700|Roboto+Slab:300,400,700" rel="stylesheet" />
<script src="js/search.js"></script>
<script async type="text/javascript" src="js/prism.js"></script>
<script data-goatcounter="https://concourse.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
  </head>
  <body>
    <div class="top-banner">
  <p class="banner-text">
    <a href="https://blog.concourse-ci.org/posts/2025-08-12-new-release-7-14/">ðŸŽ‰ v7.14.0 Released - ðŸ¦¾ First ARM Build of Concourse</a>
  </p>
</div>

<div class="page-top">
  <nav class="top-nav">
    <a class="top-link logo-link" href="/"><img src="images/logo-white.svg" />Concourse</a>
    
    <a class="top-link active" href="docs.html">Docs</a>
    
    <a class="top-link" href="examples.html">Examples</a>
    
    <a class="top-link" href="project.html">Project</a>
    
    <a class="top-link" href="ecosystem.html">Ecosystem</a>
    
    <a class="top-link" href="support.html">Support</a>
    
    <a class="top-link" href="https://resource-types.concourse-ci.org">Resource Types</a>
    <a class="top-link" href="https://blog.concourse-ci.org">blog</a>

    <div id="search"></div>

    <script type="text/javascript">
      var app = Elm.Main.init({
        node: document.getElementById('search')
      });

      app.ports.emitSearchTerm.subscribe(function(term) {
        goatcounter.count({
          path: "search:" + term,
          title: "user searched: " + term,
          event: true
        });
      });
    </script>
  </nav>
</div>

    <div class="page-body">
      <div class="page-nav">
        






  
  
  
  
  
  
  

  
  <div class="context">
    <nav>
      <div class="top">
        <span class="section-number">1</span><a href="docs.html"  class="active">Docs</a>
      </div>

      <div class="children">
        <table>
        
          <tr>
            <td class="number-cell">1.1</td>
            <td class="title-cell"><a href="getting-started.html" >Getting Started</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.2</td>
            <td class="title-cell"><a href="install.html" >Install</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.3</td>
            <td class="title-cell"><a href="auth.html" >Auth &amp; Teams</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.4</td>
            <td class="title-cell"><a href="fly.html" >The <code>fly</code> CLI</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.5</td>
            <td class="title-cell"><a href="config-basics.html" >Config Basics</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.6</td>
            <td class="title-cell"><a href="pipelines.html" >Pipelines</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.7</td>
            <td class="title-cell"><a href="vars.html" >Vars</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.8</td>
            <td class="title-cell"><a href="resources.html" >Resources</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.9</td>
            <td class="title-cell"><a href="resource-types.html" >Resource Types</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.10</td>
            <td class="title-cell"><a href="jobs.html" >Jobs</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.11</td>
            <td class="title-cell"><a href="steps.html" >Steps</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.12</td>
            <td class="title-cell"><a href="tasks.html" >Tasks</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.13</td>
            <td class="title-cell"><a href="builds.html" >Builds</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.14</td>
            <td class="title-cell"><a href="how-to-guides.html" >How-To Guides</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15</td>
            <td class="title-cell"><a href="operation.html"  class="active">Operation</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.16</td>
            <td class="title-cell"><a href="observation.html" >Observation</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.17</td>
            <td class="title-cell"><a href="internals.html" >Internals</a></td>
          </tr>
        
        </table>
      </div>
    </nav>
  </div>
  

  

  
  <div class="context">
    <nav>
      <div class="top">
        <span class="section-number">1.15</span><a href="operation.html"  class="active">Operation</a>
      </div>

      <div class="children">
        <table>
        
          <tr>
            <td class="number-cell">1.15.1</td>
            <td class="title-cell"><a href="metrics.html" >Metrics</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.2</td>
            <td class="title-cell"><a href="tracing.html" >Tracing</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.3</td>
            <td class="title-cell"><a href="encryption.html" >Encryption</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.4</td>
            <td class="title-cell"><a href="creds.html"  class="active">Credential Management</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.5</td>
            <td class="title-cell"><a href="security-hardening.html" >Security Hardening</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.6</td>
            <td class="title-cell"><a href="container-placement.html" >Container Placement</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.7</td>
            <td class="title-cell"><a href="opa.html" >Open Policy Agent Integration</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.8</td>
            <td class="title-cell"><a href="performance-tuning.html" >Performance Tuning</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.9</td>
            <td class="title-cell"><a href="global-resources.html" >Global Resources</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.10</td>
            <td class="title-cell"><a href="administration.html" >Administration</a></td>
          </tr>
        
        </table>
      </div>
    </nav>
  </div>
  

  

  
  <div class="context">
    <nav>
      <div class="top">
        <span class="section-number">1.15.4</span><a href="creds.html"  class="active">Credential Management</a>
      </div>

      <div class="children">
        <table>
        
          <tr>
            <td class="number-cell">1.15.4.1</td>
            <td class="title-cell"><a href="vault-credential-manager.html" >The Vault credential manager</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.4.2</td>
            <td class="title-cell"><a href="credhub-credential-manager.html" >The CredHub credential manager</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.4.3</td>
            <td class="title-cell"><a href="aws-ssm-credential-manager.html" >The AWS SSM credential manager</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.4.4</td>
            <td class="title-cell"><a href="aws-asm-credential-manager.html" >The AWS Secrets Manager credential manager</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.4.5</td>
            <td class="title-cell"><a href="kubernetes-credential-manager.html" >Kubernetes Credential Manager</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.4.6</td>
            <td class="title-cell"><a href="conjur-credential-manager.html" >The Conjur credential manager</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.4.7</td>
            <td class="title-cell"><a href="idtoken-credential-manager.html"  class="self">The IDToken credential manager</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.4.8</td>
            <td class="title-cell"><a href="creds-caching.html" >Caching credentials</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.4.9</td>
            <td class="title-cell"><a href="creds-redacting.html" >Redacting credentials</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.4.10</td>
            <td class="title-cell"><a href="creds-retry-logic.html" >Retrying failed fetches</a></td>
          </tr>
        
        </table>
      </div>
    </nav>
  </div>
  

  

  



      </div>

      <div class="body-content">
        <div class="page-content">
          <div class="section" id="section_idtoken-credential-manager">
  
  <h1 class="section-header"><a class="anchor-target" name="idtoken-credential-manager" href="#idtoken-credential-manager"></a><span class="section-number">1.15.4.7 </span>The IDToken credential manager</h1>
  

  <p>This idtoken credential manager is a bit special. It doesn&#39;t load any credentials from an external source but instead generates <a href="https://datatracker.ietf.org/doc/html/rfc7519">JWTs</a> which are signed by concourse and contain information about the pipeline/job that is currently running. It can NOT be used as a cluster-wide credential manager, but must instead be used as a <a href="vars.html#var-sources">var source</a>.</p><p>These JWTs can be used to authenticate with external services via &#34;identity federation&#34; with the identity of the pipeline.</p><p>Examples for services that support authentication via JWTs are:</p><ul>

  <li><p><a href="https://vaultproject.io">Vault</a></p></li>

  <li><p><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_providers.html">AWS</a></p></li>

  <li><p><a href="https://learn.microsoft.com/en-us/graph/api/resources/federatedidentitycredentials-overview?view=graph-rest-1.0">Azure</a></p></li>

</ul><p>External services can verify if JWTs are actually issued by your Concourse, by checking the signatures on the JWTs against the public keys published by your Concourse.</p><p>The public keys for verification are published as <a href="https://datatracker.ietf.org/doc/html/rfc7517">JWKS</a> at: <pre><code class="language-bash">https://your-concourse-server.com/.well-known/jwks.json</code></pre></p><p>Concourse also offers a <a href="https://openid.net/specs/openid-connect-discovery-1_0.html">OIDC Discovery Endpoint</a>, which allows external services to auto-discover the JWKS-URL.</p>

  
    
      <div class="section" id="section_usage">
  
  <h2 class="section-header"><a class="anchor-target" name="usage" href="#usage"></a>Usage</h2>
  

  <p>You create a <a href="vars.html#var-sources">var source</a> of type <code>idtoken</code> with the configuration you want (see <a href="idtoken-credential-manager.html#idtoken-credential-manager-config">Configuration</a>) in your pipeline. That var source then exposes a single variable with a single field, <code>token</code>, which contains the JWT and can be used in any step of your pipeline.</p><p>You can also have multiple <code>idtoken</code> var sources in the same pipeline, each with different audiences, lifetimes etc.</p><pre><code class="language-bash">var_sources:
- name: myidtoken
  type: idtoken
  config:
    audience: [&#34;sts.amazonaws.com&#34;]

jobs:
- name: print-creds
  plan:
  - task: print
    config:
      platform: linux
      image_resource:
        type: mock
        source: {mirror_self: true}
      run:
        path: bash
        args:
        - -c
        - |
          echo myidtoken: ((myidtoken:token))</code></pre>

  
    
  
</div>
    
      <div class="section" id="section_idtoken-credential-manager-config">
  
  <h2 class="section-header"><a class="anchor-target" name="idtoken-credential-manager-config" href="#idtoken-credential-manager-config"></a>Configuration</h2>
  

  <p>You can pass several config options to the <code>idtoken</code> var source to customize the generated JWTs. For example, you can configure the <code>aud</code> claim, token expiration, or granularity of the <code>sub</code> claim. See <a href="vars.html#idtoken-var-source"><code>idtoken</code> var source</a> for all config options.</p>

  
    
      <div class="section" id="section_idtoken-subject-scope">
  
  <h3 class="section-header"><a class="anchor-target" name="idtoken-subject-scope" href="#idtoken-subject-scope"></a>Subject Scope</h3>
  

  <p>Some external services (like AWS) only perform exact-matches on a token&#39;s sub-claim and ignore most other claims. To enable use-cases like <em>&#34;all pipelines of a team should be able to assume an AWS-Role&#34;</em>, Concourse offers the option to configure how granular the <code>sub</code> claim&#39;s value should be.</p><p>This is configured via the <code>subject_scope</code> setting of the <a href="vars.html#idtoken-var-source"><code>idtoken</code> var source</a>.</p><p>Depending on the value of <code>subject_scope</code>, the content of the JWT&#39;s <code>sub</code> claim will differ:</p><table>
  
  <tr>
    
    <td><code>subject_scope</code></td>
    
    <td><code>sub</code> Value in JWT</td>
    
  </tr>
  
  <tr>
    
    <td><p><code>team</code></p></td>
    
    <td><p><code>&lt;team_name&gt;</code></p></td>
    
  </tr>
  
  <tr>
    
    <td><p><code>pipeline</code></p></td>
    
    <td><p><code>&lt;team_name&gt;/&lt;pipeline_name&gt;</code></p></td>
    
  </tr>
  
  <tr>
    
    <td><p><code>instance</code></p></td>
    
    <td><p><code>&lt;team_name&gt;/&lt;pipeline_name&gt;/&lt;instance_vars&gt;</code> <sup>1</sup></p></td>
    
  </tr>
  
  <tr>
    
    <td><p><code>job</code></p></td>
    
    <td><p><code>&lt;team_name&gt;/&lt;pipeline_name&gt;/&lt;instance_vars&gt;/&lt;job_name&gt;</code> <sup>2</sup></p></td>
    
  </tr>
  
</table><ul>

  <li><p><span style="font-size: 80%">[1]: Instance vars are rendered as comma-separated key-value pairs. E.g. <code>my-var:my-value,hello:world</code> </span></p></li>

  <li><p><span style="font-size: 80%">[2]: If a path element is empty (for example because you chose <code>job</code> on a pipeline with no instance-vars), the empty element is still added. E.g. <code>my-team/my-pipeline//my-job</code>. Note the double forward-slashes between the pipeline and job name, where instance vars would go. </span></p></li>

</ul><p>This way all your pipelines can simply get a token with <code>subject_scope: team</code> and use this token to assume an AWS-Role that matches on <code>sub: &#34;your_team_name&#34;</code>.</p>

  
    
  
</div>
    
  
</div>
    
      <div class="section" id="section_example-jwt">
  
  <h2 class="section-header"><a class="anchor-target" name="example-jwt" href="#example-jwt"></a>Example JWT</h2>
  

  <p>The generated tokens usually look something like this: <pre><p>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJodHRwczovL3lvdXItY29uY291cnNlLmV4YW1wbGUuY29tIiwiZXhwIjoxNzUxMDE1NzM0LCJhdWQiOlsiYXBpOi8vQXp1cmVBRFRva2VuRXhjaGFuZ2UiXSwic3ViIjoibWFpbi9leGFtcGxlLXBpcGVsaW5lIiwidGVhbSI6Im1haW4iLCJwaXBlbGluZSI6ImV4YW1wbGUtcGlwZWxpbmUiLCJqb2IiOiJleGFtcGxlLWpvYiJ9.my7l44tH0wfz8vc6z3fMmzTMxZ8_orhjcsOti3BKSNo</p></pre></p><p>And after decoding, looks like this: <pre><code class="language-bash">{
  &#34;aud&#34;: &#34;sts.amazonaws.com&#34;,
  &#34;exp&#34;: 1751282764,
  &#34;iat&#34;: 1751279164,
  &#34;iss&#34;: &#34;https://your-concourse-server.com&#34;,
  &#34;job&#34;: &#34;print-creds&#34;,
  &#34;pipeline&#34;: &#34;mypipeline&#34;,
  &#34;sub&#34;: &#34;main/mypipeline&#34;,
  &#34;team&#34;: &#34;main&#34;
}</code></pre></p><p>Here is a short explanation of the different claims:</p><ul>

  <li><p><code>iss</code>: Who issued the token (always contains the external URL of your Concourse)</p></li>

  <li><p><code>exp</code>: When the token will expire</p></li>

  <li><p><code>aud</code>: Who the token is intended for. (In the above example it&#39;s for Azure&#39;s Identity Federation API)</p></li>

  <li><p><code>team</code>: The team of the pipeline this token was generated for</p></li>

  <li><p><code>pipeline</code>: The pipeline this token was generated for</p></li>

  <li><p><code>job</code>: The name of the job (inside the pipeline) this token was generated for</p></li>

  <li><p><code>instance_vars</code>: Any instance vars for the pipeline (if it is an instanced pipeline). Will be a comma-separated list of key-value pairs. E.g. <code>hello:world,my-var:my-value</code></p></li>

  <li><p><code>sub</code>: A combination of team &#43; pipeline &#43; instance_vars &#43; job. Which parts are used here is configurable, see <a href="idtoken-credential-manager.html#idtoken-subject-scope">Subject Scope</a>.</p></li>

</ul>

  
    
  
</div>
    
      <div class="section" id="section_idtoken-key-rotation">
  
  <h2 class="section-header"><a class="anchor-target" name="idtoken-key-rotation" href="#idtoken-key-rotation"></a>Automatic Key Rotation</h2>
  

  <p>Concourse will automatically rotate the signing keys used for creating the JWTs. The default rotation period is <code>7 days</code>. The previously used keys are being kept around for a while (by default <code>24h</code>) so that verification of currently existing JWTs doesn&#39;t fail during key rotation.</p><p>This behavior can be configured via the following ATC flags:</p><ul>

  <li><p><code>CONCOURSE_SIGNING_KEY_ROTATION_PERIOD</code>: How often to rotate the signing keys. Default: <code>7d</code>. A value of <code>0</code> means don&#39;t rotate at all.</p></li>

  <li><p><code>CONCOURSE_SIGNING_KEY_GRACE_PERIOD</code>: How long to keep previously used signing keys published in the JWKs after they have been rotated. Default: <code>24h</code>.</p></li>

  <li><p><code>CONCOURSE_SIGNING_KEY_CHECK_INTERVAL</code>: How often to check if new keys are needed or if old ones should be removed. Default: <code>10m</code></p></li>

</ul>

  
    
  
</div>
    
  
</div>

          <nav class="prev-next">
          
            <div class="prev">
              prev:

              
              <span class="section-number">1.15.4.6</span>
              

              <a href="conjur-credential-manager.html">The Conjur credential manager</a>
            </div>
          

          
            <div class="next">
              next:

              
              <span class="section-number">1.15.4.8</span>
              

              <a href="creds-caching.html">Caching credentials</a>
            </div>
          
          </nav>
        </div>

        <div class="page-aside">
          <div class="page-partial">
            <div class="content">
  <h2>Examples</h2>

  <div class="example">
  <h3>Vault</h3>

  <p>You can use JWTs to authenticate with <a href="https://developer.hashicorp.com/vault/docs/auth/jwt#jwt-authentication">HashiCorp Vault</a>. This way your pipelines can directly communicate with Vault and use all of it&#39;s features, beyond what Concourse&#39;s native Vault-integration offers.</p><p>First enable the JWT auth method in your Vault Server: <pre><code class="language-bash">vault auth enable jwt</code></pre></p><p>Now configure the JWT auth method to accept JWTs issued by your Concourse: <pre><code class="language-bash">vault write auth/jwt/config \
  oidc_discovery_url=&#34;https://&lt;external_url_of_your_concourse&gt;&#34; \
  default_role=&#34;demo&#34;</code></pre></p><p>Lastly, configure a role for JWT auth. Make sure to use the same value in your pipeline that you used for <em>bound_audiences</em> (the best would be the URL of your Vault). <em>bound_subject</em> must be the sub-claim value of your JWT, if you use the <em>subject_scope</em> setting to change the contents of your sub-claim, adapt this accordingly! <pre><code class="language-bash">vault write auth/jwt/role/demo \
role_type=&#34;jwt&#34;\
user_claim=&#34;sub&#34; \
bound_subject=&#34;main/your-pipeline&#34; \
bound_audiences=&#34;my-vault-server.com&#34; \
policies=webapps \
ttl=1h</code></pre></p><p>This role will allow the holder of a JWT with <code>aud: &#34;my-vault-server.com&#34;</code> and <code>sub: &#34;main/your-pipeline&#34;</code> to get a Vault token with the Vault-policy <code>webapps</code>. If the policy you want to assign has a different name, simply change it in the above example. Make sure to adapt the value for <code>bound_subject</code> according to your team and pipeline name.</p><p>Pipelines can now do the following: <pre><code class="language-yaml">var_sources:
- name: vaulttoken
  type: idtoken
  config:
    audience: [&#34;my-vault-server.com&#34;]

jobs:
- name: vault-login
  plan:
  - task: login
    config:
      platform: linux
      image_resource:
        type: registry-image
        source: { repository: hashicorp/vault }
      run:
        path: sh
        args:
        - -e
        - -c
        - |
          export VAULT_ADDR=https://my-vault-server.com
          vault write auth/jwt/login \
            role=demo \
            jwt=((vaulttoken:token)) \
            --format=json &gt; vault-response.json
          echo &#34;Now do something with the token in vault-response.json&#34;</code></pre></p><p>You don&#39;t have to create a role and a policy for every single of your pipelines! You can use claims from the JWT with Vault&#39;s <a href="https://developer.hashicorp.com/vault/tutorials/policies/policy-templating">policy templating</a> feature. This way you can define a policy that allows a pipeline read to all the secrets it would usually have access to using Concourse&#39;s native Vault-integration:</p><p><pre><code class="language-bash">path &#34;concourse/metadata/{{ identity.entity.aliases.&lt;JWT_ACCESSOR&gt;.metadata.team }}&#34; {
  capabilities = [&#34;list&#34;]
}

path &#34;concourse/data/{{ identity.entity.aliases.&lt;JWT_ACCESSOR&gt;.metadata.team }}/&#43;&#34; {
  capabilities = [&#34;read&#34;]
}

path &#34;concourse/metadata/{{ identity.entity.aliases.&lt;JWT_ACCESSOR&gt;.metadata.team }}/{{ identity.entity.aliases.&lt;JWT_ACCESSOR&gt;.metadata.pipeline }}&#34; {
  capabilities = [&#34;list&#34;]
}

path &#34;concourse/metadata/{{ identity.entity.aliases.&lt;JWT_ACCESSOR&gt;.metadata.team }}/{{ identity.entity.aliases.&lt;JWT_ACCESSOR&gt;.metadata.pipeline }}/*&#34; {
  capabilities = [&#34;read&#34;, &#34;list&#34;]
}

path &#34;concourse/data/{{ identity.entity.aliases.&lt;JWT_ACCESSOR&gt;.metadata.team }}/{{ identity.entity.aliases.&lt;JWT_ACCESSOR&gt;.metadata.pipeline }}/*&#34; {
  capabilities = [&#34;read&#34;, &#34;list&#34;]
}</code></pre> <span style="font-size: 80%">Make sure to set <code>&lt;JWT_ACCESSOR&gt;</code> to the actual mount-accessor value of your JWT Auth method! You can use <code>vault auth list --format=json | jq -r &#39;.&#34;jwt/&#34;.accessor&#39;</code> to get the accessor for your jwt auth method. </span></p><p>With a policy like this you don&#39;t need to configure <code>bound_subject</code> in your JWT auth role. Every single pipeline can simply use the same role and the policy will take care that they can only access secrets meant for them. However you need to explicitly configure claim to metadata mapping:</p><pre><code class="language-bash">vault write auth/jwt/role/demo \
  role_type=&#34;jwt&#34;\
  user_claim=&#34;sub&#34; \
  bound_subject= \
  bound_audiences=&#34;my-vault-server.com&#34; \
  policies=pipeline-new \
  claim_mappings=&#39;team=team&#39; \
  claim_mappings=&#39;pipeline=pipeline&#39; \
  ttl=1h</code></pre>
</div><div class="example">
  <h3>AWS</h3>

  <p>AWS supports <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_providers.html">federation with external identity providers</a>. Using this, you can allow identities managed by an external identity provider to perform actions in your AWS account.</p><p>In this scenario the external identity provider is Concourse and the identities are teams/pipelines/jobs. This means you are able to grant a specific pipeline or job permission to perform actions in AWS (like deploying something), all without managing IAM users or dealing with long-lived credentials.</p><p>First you need to <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_providers_create_oidc.html">create an OpenID Connect identity provider</a> in your AWS Account. Set <em>Provider URL</em> to the external URL of your Concourse server. For <em>Audience</em>, you can choose any string you like, but using a value like <code>sts.amazonaws.com</code> is recommended. You have to use the same string later in the configuration of your <a href="vars.html#idtoken-var-source"><code>idtoken</code> var source</a>.</p><p>Next you will need to <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_create_for-idp_oidc.html#idp_oidc_Create">create an IAM-Role that can be assumed using your JWT</a>. Set <em>Identity Provider</em> to the value you previously set <em>Audience</em> to. Add a condition on the sub-claim with type <code>StringEquals</code> and value <code>yourteam/yourpipeline</code>. This will allow ONLY that specific pipeline (and any instanced versions of it) to assume that IAM Role using a JWT. If you use the <code>subject_scope</code> setting to change the contents of your sub-claim, adapt this condition accordingly! In the next step you will be able to choose which AWS permissions your role will get.</p><p>Now you can use the AWS <a href="https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRoleWithWebIdentity.html">AssumeRoleWithWebIdentity API operation</a> to assume your role via a JWT issued by Concourse. The easiest way is to do this is via the <a href="https://docs.aws.amazon.com/cli/latest/reference/sts/assume-role-with-web-identity.html">assume-role-with-web-identity AWS CLI command</a>:</p><pre><code class="language-yaml">var_sources:
- name: awstoken
  type: idtoken
  config:
    audience: [&#34;sts.amazonaws.com&#34;]

jobs:
- name: aws-login
  plan:
  - task: print
    config:
      platform: linux
      image_resource:
        type: registry-image
        source: { repository: amazon/aws-cli }
      run:
        path: bash
        args:
        - -e
        - -c
        - |
          aws sts assume-role-with-web-identity \
            --role-session-name Concourse \
            --role-arn arn:aws:iam::&lt;your_account&gt;:role/&lt;your_role&gt; \
            --web-identity-token ((awstoken:token)) &gt; creds.json
          echo &#34;Now do something with the temporary credentials in creds.json&#34;</code></pre>
</div><div class="example">
  <h3>Azure</h3>

  <p>Azure also supports a way to grant the holder of a JWT permissions in the Cloud. This is done via a feature called <a href="https://learn.microsoft.com/en-us/graph/api/resources/federatedidentitycredentials-overview?view=graph-rest-1.0">Federated Credentials</a>.</p><p>First, <a href="https://learn.microsoft.com/en-us/entra/identity-platform/quickstart-register-app">create an EntraID App Registration</a>. This app registration will be the service principal used by your pipeline.</p><p>Now <a href="https://learn.microsoft.com/en-us/entra/workload-id/workload-identity-federation-create-trust?pivots=identity-wif-apps-methods-azp#other-identity-providers">create a federated credential</a> for the app registration you just created.</p><p>For <em>Scenario</em> select &#34;Other&#34;. For <em>Issuer</em> set it to the external URL of your Concourse server. For <em>Type</em> select &#34;Explicit subject identifier&#34; and set <em>Value</em> to <code>&lt;teamname&gt;/&lt;pipelinename&gt;</code> of the pipeline that should be able to use the identity. If you use the <code>subject_scope</code> setting to change the contents of your sub-claim, change this setting here accordingly.</p><p>You can now assign IAM permissions to the identity of the app registration, which define what the identity is allowed to do in your Azure subscription.</p><p>Your pipeline can now use the <code>az</code> cli to login to Azure using a JWT generated by Concourse: <pre><code class="language-yaml">var_sources:
- name: azuretoken
  type: idtoken
  config:
    audience: [&#34;api://AzureADTokenExchange&#34;]

jobs:
- name: azure-deploy
  plan:
  - task: login
    config:
      platform: linux
      image_resource:
        type: registry-image
        source: { repository: mcr.microsoft.com/azure-cli }
      run:
        path: bash
        args:
        - -e
        - -c
        - |
          echo ((azuretoken:token))
          az login --service-principal \
            -u &lt;client_id of your app registration&gt; \
            --tenant &lt;tenant_id of your app registration&gt; \
            --federated-token ((azuretoken:token))
          echo &#34;You are now authenticated with Azure. Do something with it!&#34;</code></pre></p>
</div>
</div>
          </div>
          </div>
      </div>
    </div>

    <ul class="improve-docs">
      <li><img src="images/icons/github-box.svg" /> <a href="https://github.com/concourse/docs">help improve this site</a></li>
      <li><img src="images/booklit.svg" /> powered by <a href="https://vito.github.io/booklit">Booklit</a></li>
    </ul>
  </body>
</html>