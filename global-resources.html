<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=775" />
<title>Global Resources - Concourse CI</title>
<link rel="stylesheet" type="text/css" href="css/normalize.css" />
<link rel="stylesheet" type="text/css" href="css/pipeline.css" />
<link rel="stylesheet" type="text/css" href="css/iosevka.css" />
<link rel="stylesheet" type="text/css" href="css/booklit.css" />
<link rel="stylesheet" type="text/css" href="css/prism.css" />
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
<link href="https://fonts.googleapis.com/css?family=Barlow:400,400i,700|Roboto+Slab:300,400,700" rel="stylesheet" />
<script src="js/search.js"></script>
<script async type="text/javascript" src="js/prism.js"></script>
<script data-goatcounter="https://concourse.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
  </head>
  <body>
    <div class="top-banner">
  <p class="banner-text">
    <a href="https://github.com/orgs/concourse/discussions/9265">ðŸ“£ Call for Help: Check your database for us! ðŸ“£</a>
  </p>
</div>

<div class="page-top">
  <nav class="top-nav">
    <a class="top-link logo-link" href="/"><img src="images/logo-white.svg" />Concourse</a>
    
    <a class="top-link active" href="docs.html">Docs</a>
    
    <a class="top-link" href="examples.html">Examples</a>
    
    <a class="top-link" href="project.html">Project</a>
    
    <a class="top-link" href="ecosystem.html">Ecosystem</a>
    
    <a class="top-link" href="support.html">Support</a>
    
    <a class="top-link" href="https://resource-types.concourse-ci.org">Resource Types</a>
    <a class="top-link" href="https://blog.concourse-ci.org">blog</a>

    <div id="search"></div>

    <script type="text/javascript">
      var app = Elm.Search.init({
        node: document.getElementById('search')
      });

      app.ports.emitSearchTerm.subscribe(function(term) {
        goatcounter.count({
          path: "search:" + term,
          title: "user searched: " + term,
          event: true
        });
      });
    </script>
  </nav>
</div>

    <div class="page-body">
      <div class="page-nav">
        






  
  
  
  
  

  
  <div class="context">
    <nav>
      <div class="top">
        <span class="section-number">1</span><a href="docs.html"  class="active">Docs</a>
      </div>

      <div class="children">
        <table>
        
          <tr>
            <td class="number-cell">1.1</td>
            <td class="title-cell"><a href="getting-started.html" >Getting Started</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.2</td>
            <td class="title-cell"><a href="install.html" >Install</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.3</td>
            <td class="title-cell"><a href="auth.html" >Auth &amp; Teams</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.4</td>
            <td class="title-cell"><a href="fly.html" >The <code>fly</code> CLI</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.5</td>
            <td class="title-cell"><a href="config-basics.html" >Config Basics</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.6</td>
            <td class="title-cell"><a href="pipelines.html" >Pipelines</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.7</td>
            <td class="title-cell"><a href="vars.html" >Vars</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.8</td>
            <td class="title-cell"><a href="resources.html" >Resources</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.9</td>
            <td class="title-cell"><a href="resource-types.html" >Resource Types</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.10</td>
            <td class="title-cell"><a href="jobs.html" >Jobs</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.11</td>
            <td class="title-cell"><a href="steps.html" >Steps</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.12</td>
            <td class="title-cell"><a href="tasks.html" >Tasks</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.13</td>
            <td class="title-cell"><a href="builds.html" >Builds</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.14</td>
            <td class="title-cell"><a href="how-to-guides.html" >How-To Guides</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15</td>
            <td class="title-cell"><a href="operation.html"  class="active">Operation</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.16</td>
            <td class="title-cell"><a href="observation.html" >Observation</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.17</td>
            <td class="title-cell"><a href="internals.html" >Internals</a></td>
          </tr>
        
        </table>
      </div>
    </nav>
  </div>
  

  

  
  <div class="context">
    <nav>
      <div class="top">
        <span class="section-number">1.15</span><a href="operation.html"  class="active">Operation</a>
      </div>

      <div class="children">
        <table>
        
          <tr>
            <td class="number-cell">1.15.1</td>
            <td class="title-cell"><a href="metrics.html" >Metrics</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.2</td>
            <td class="title-cell"><a href="tracing.html" >Tracing</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.3</td>
            <td class="title-cell"><a href="encryption.html" >Encryption</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.4</td>
            <td class="title-cell"><a href="creds.html" >Credential Management</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.5</td>
            <td class="title-cell"><a href="security-hardening.html" >Security Hardening</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.6</td>
            <td class="title-cell"><a href="container-placement.html" >Container Placement</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.7</td>
            <td class="title-cell"><a href="opa.html" >Open Policy Agent Integration</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.8</td>
            <td class="title-cell"><a href="performance-tuning.html" >Performance Tuning</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.9</td>
            <td class="title-cell"><a href="global-resources.html"  class="self">Global Resources</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.10</td>
            <td class="title-cell"><a href="administration.html" >Administration</a></td>
          </tr>
        
        </table>
      </div>
    </nav>
  </div>
  

  

  
  <div class="context">
    <nav>
      <div class="top">
        <span class="section-number">1.15.9</span><a href="global-resources.html"  class="self">Global Resources</a>
      </div>

      <div class="children">
        <table>
        
          <tr>
            <td class="number-cell">1.15.9.1</td>
            <td class="title-cell"><a href="global-resources.html#benefits-of-global-resources" >Benefits of Global Resources</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.9.2</td>
            <td class="title-cell"><a href="global-resources.html#risks-and-side-effects" >Risks and Side Effects</a></td>
          </tr>
        
        </table>
      </div>
    </nav>
  </div>
  



      </div>

      <div class="body-content">
        <div class="page-content">
          <div class="section" id="section_global-resources">
  
  <h1 class="section-header"><a class="anchor-target" name="global-resources" href="#global-resources"></a><span class="section-number">1.15.9 </span>Global Resources</h1>
  

  <p>Concourse v5.0 contains an experimental feature known as &#34;global resources&#34;. It is enabled by passing the <code>--enable-global-resources</code> flag to the <code>concourse web</code> command.</p><p>The basic concept of global resources is to share detected resource versions between all resources that have the same <a href="resources.html#schema.resource.type"><code class="schema-attribute-name"><bold>resource<wbr />.type</bold></code></a> and <a href="resources.html#schema.resource.source"><code class="schema-attribute-name"><bold>resource<wbr />.source</bold></code></a> configuration.</p><p>Before v5.0.0, each pipeline resource had its own version history, associated to the resource by name. This meant that multiple pipelines with the same resource configs would redundantly collect the same version and metadata information.</p><p>With v5.0.0&#39;s experimental &#39;global resources&#39; feature, resource versions are instead associated to an anonymous &#39;resource config&#39; i.e. its <a href="resources.html#schema.resource.type"><code class="schema-attribute-name"><bold>resource<wbr />.type</bold></code></a> and <a href="resources.html#schema.resource.source"><code class="schema-attribute-name"><bold>resource<wbr />.source</bold></code></a>.</p>

  
    
      <div class="section" id="section_benefits-of-global-resources">
  
  <h2 class="section-header"><a class="anchor-target" name="benefits-of-global-resources" href="#benefits-of-global-resources"></a>Benefits of Global Resources</h2>
  

  

  
    
      <div class="section" id="section_fewer-resource-checks-to-perform">
  
  <h3 class="section-header"><a class="anchor-target" name="fewer-resource-checks-to-perform" href="#fewer-resource-checks-to-perform"></a>Fewer resource <code>check</code>s to perform</h3>
  

  <p>With global resources, all resources that have the same configuration will share the same version history and share only one checking interval. This reduces load on the worker and on the external services that the resources point to.</p><p>For example, prior to global resources if there were three resources with the same configuration between three team&#39;s pipelines it would result in three check containers performing three resource checks every minute to fetch the versions.</p><p>With global resources, this configuration will result in only one check container and one resource check every minute to fetch versions for all the resources.</p><p>Since there will be only one resource check for all resources that have the same configuration, the resource that has the shortest <a href="resources.html#schema.resource.check_every"><code class="schema-attribute-name"><bold>resource<wbr />.check_every</bold></code></a> configured will result in its pipeline running the checks for that resource configuration.</p>

  
    
      <div class="section" id="section_complications-with-reusing-containers">
  
  <h4 class="section-header"><a class="anchor-target" name="complications-with-reusing-containers" href="#complications-with-reusing-containers"></a>Complications with reusing containers</h4>
  

  <p>There is an exception to sharing check containers within a deployment, which is workers belonging to a team and workers with tags.</p><p>If a resource has <a href="resources.html#schema.resource.tags"><code class="schema-attribute-name"><bold>resource<wbr />.tags</bold></code></a> configured, <em>and</em> the resource&#39;s check interval ends up acquiring the checking lock, if a check container already exists with the same resource config elsewhere, it will reuse the container, otherwise a container will be created on a worker matching the appropriate tags.</p><p>Similarly, if a team has its own workers, and their check interval ended up acquiring the lock, it will try to re-use a container with the same resource config from the shared worker pool, rather than creating a new container on the team&#39;s workers.</p><p>This is a bit complicated to reason about and we plan to stop re-using <code>check</code> containers to simplify all of this. See <a href="https://github.com/concourse/concourse/issues/3079">concourse/concourse#3079</a> for more information.</p>

  
    
  
</div>
    
  
</div>
    
      <div class="section" id="section_reducing-redundant-data">
  
  <h3 class="section-header"><a class="anchor-target" name="reducing-redundant-data" href="#reducing-redundant-data"></a>Reducing redundant data</h3>
  

  <p>The majority of Concourse resources will benefit from having versions shared globally because most resource versions have an external source of truth.</p><p>For example, a <code>check</code> for the <a href="https://github.com/concourse/git-resource"><code>git</code> resource</a> that pulls in the <code>concourse/concourse</code> repository will always return the same set of versions as an equivalent resource pointing to the same repository. By consolidating the <code>check</code>s and the versions, there will essentially only be one set of versions collected from the repository and saved into the database.</p>

  
    
  
</div>
    
      <div class="section" id="section_reliable-resource-version-history">
  
  <h3 class="section-header"><a class="anchor-target" name="reliable-resource-version-history" href="#reliable-resource-version-history"></a>Reliable Resource Version History</h3>
  

  <p>Prior to global resources, a resource&#39;s version history was directly associated to the resource name. This meant that any changes to a resource&#39;s configuration without changing its name would basically append the versions from the new configuration after the old versions, which are no longer accurate to the current configuration.</p><p>Global resources instead associates the resource versions to the resource&#39;s <a href="resources.html#schema.resource.type"><code class="schema-attribute-name"><bold>resource<wbr />.type</bold></code></a> and <a href="resources.html#schema.resource.source"><code class="schema-attribute-name"><bold>resource<wbr />.source</bold></code></a>. Therefore, whenever a resource definition changes, the versions will &#34;reset&#34; and change along with it, resulting in truthful and reliable version histories.</p>

  
    
  
</div>
    
  
</div>
    
      <div class="section" id="section_risks-and-side-effects">
  
  <h2 class="section-header"><a class="anchor-target" name="risks-and-side-effects" href="#risks-and-side-effects"></a>Risks and Side Effects</h2>
  

  

  
    
      <div class="section" id="section_sharing-versions-doesnt-work-well-for-all-resource-types">
  
  <h3 class="section-header"><a class="anchor-target" name="sharing-versions-doesnt-work-well-for-all-resource-types" href="#sharing-versions-doesnt-work-well-for-all-resource-types"></a>Sharing versions doesn&#39;t work well for all resource types</h3>
  

  <p>Sharing versions isn&#39;t always a good idea. For example, the <a href="https://github.com/concourse/time-resource"><code>time</code> resource</a> is often used to generate versions on an interval so that jobs can fire periodically. If version history were to be shared for all users with e.g. a 10 minute interval, that would lead to a thundering herd of builds storming your workers, leading to load spikes and a lot of unhappy builds.</p><p>We are working toward a solution to the <a href="https://github.com/concourse/time-resource"><code>time</code> resource</a>&#39;s thundering herd problem - namely, to not model time as a resource, and instead model it as a <a href="pipelines.html#schema.pipeline.var_sources"><code>var_source</code></a>. We are tracking progress toward this goal in <a href="https://github.com/concourse/concourse/issues/5815">concourse/concourse#5815</a>.</p><p>Another case where version history shouldn&#39;t be shared is when resources &#34;automagically&#34; learn their auth credentials using things like IAM roles. In these cases, the credentials aren&#39;t in the <a href="resources.html#schema.resource.source"><code class="schema-attribute-name"><bold>resource<wbr />.source</bold></code></a>. If version history were to be shared, anyone could configure the same <code>source:</code>, not specifying any credentials, and see the version history discovered by some other pipeline that ran its checks on workers that had access via IAM roles.</p><p>For this reason, any resource types that acquire credentials outside of <code>source:</code> should not share version history. Granted, the user won&#39;t be able to <em>fetch</em> these versions, but it&#39;s still an information leak.</p><p>IAM roles are a bit of a thorn in our side when it comes to designing features like this. We&#39;re planning on introducing support for them in a way that doesn&#39;t have this problem in <a href="https://github.com/concourse/concourse/issues/3023">concourse/concourse#3023</a>.</p>

  
    
  
</div>
    
      <div class="section" id="section_intercept-admin-only">
  
  <h3 class="section-header"><a class="anchor-target" name="intercept-admin-only" href="#intercept-admin-only"></a>Intercepting <code>check</code> containers is no longer safe</h3>
  

  <p>Now that <code>check</code> containers are shared across teams, it would be dangerous to allow anyone to <a href="builds.html#fly-intercept"><code>fly intercept</code></a> to <code>check</code> containers. For this reason, this capability is limited to <a href="user-roles.html#concourse-admin">admin users</a>.</p><p>We recognize that this will make it a bit more difficult for end users to debug things like failing checks. We plan to improve this by introducing a way to provision a <em>new</em> <code>check</code> container to facilitate debugging. See <a href="https://github.com/concourse/concourse/issues/3344">concourse/concourse#3344</a> for more information.</p>

  
    
  
</div>
    
  
</div>
    
  
</div>

          <nav class="prev-next">
          
            <div class="prev">
              prev:

              
              <span class="section-number">1.15.8</span>
              

              <a href="performance-tuning.html">Performance Tuning</a>
            </div>
          

          
            <div class="next">
              next:

              
              <span class="section-number">1.15.10</span>
              

              <a href="administration.html">Administration</a>
            </div>
          
          </nav>
        </div>

        <div class="page-aside"></div>
      </div>
    </div>

    <ul class="improve-docs">
      <li><img src="images/icons/github-box.svg" /> <a href="https://github.com/concourse/docs">help improve this site</a></li>
      <li><img src="images/booklit.svg" /> powered by <a href="https://vito.github.io/booklit">Booklit</a></li>
    </ul>
  </body>
</html>