<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=775" />
<title>The AWS SSM credential manager - Concourse CI</title>
<link rel="stylesheet" type="text/css" href="css/normalize.css" />
<link rel="stylesheet" type="text/css" href="css/pipeline.css" />
<link rel="stylesheet" type="text/css" href="css/iosevka.css" />
<link rel="stylesheet" type="text/css" href="css/booklit.css" />
<link rel="stylesheet" type="text/css" href="css/prism.css" />
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
<link href="https://fonts.googleapis.com/css?family=Barlow:400,400i,700|Roboto+Slab:300,400,700" rel="stylesheet" />
<script src="js/search.js"></script>
<script async type="text/javascript" src="js/prism.js"></script>
<script data-goatcounter="https://concourse.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
  </head>
  <body>
    

<div class="page-top">
  <nav class="top-nav">
    <a class="top-link logo-link" href="/"><img src="images/logo-white.svg" />Concourse</a>
    
    <a class="top-link active" href="docs.html">Docs</a>
    
    <a class="top-link" href="examples.html">Examples</a>
    
    <a class="top-link" href="project.html">Project</a>
    
    <a class="top-link" href="ecosystem.html">Ecosystem</a>
    
    <a class="top-link" href="https://resource-types.concourse-ci.org">Resource Types</a>
    <a class="top-link" href="https://blog.concourse-ci.org">blog</a>
    <a class="top-link" href="https://github.com/concourse/concourse/discussions">discuss</a>

    <div id="search"></div>

    <script type="text/javascript">
      var app = Elm.Main.init({
        node: document.getElementById('search')
      });

      app.ports.emitSearchTerm.subscribe(function(term) {
        goatcounter.count({
          path: "search:" + term,
          title: "user searched: " + term,
          event: true
        });
      });
    </script>
  </nav>
</div>

    <div class="page-body">
      <div class="page-nav">
        






  
  
  
  
  
  
  

  
  <div class="context">
    <nav>
      <div class="top">
        <span class="section-number">1</span><a href="docs.html"  class="active">Docs</a>
      </div>

      <div class="children">
        <table>
        
          <tr>
            <td class="number-cell">1.1</td>
            <td class="title-cell"><a href="getting-started.html" >Getting Started</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.2</td>
            <td class="title-cell"><a href="install.html" >Install</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.3</td>
            <td class="title-cell"><a href="auth.html" >Auth &amp; Teams</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.4</td>
            <td class="title-cell"><a href="fly.html" >The <code>fly</code> CLI</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.5</td>
            <td class="title-cell"><a href="config-basics.html" >Config Basics</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.6</td>
            <td class="title-cell"><a href="pipelines.html" >Pipelines</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.7</td>
            <td class="title-cell"><a href="vars.html" >Vars</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.8</td>
            <td class="title-cell"><a href="resources.html" >Resources</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.9</td>
            <td class="title-cell"><a href="resource-types.html" >Resource Types</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.10</td>
            <td class="title-cell"><a href="jobs.html" >Jobs</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.11</td>
            <td class="title-cell"><a href="steps.html" >Steps</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.12</td>
            <td class="title-cell"><a href="tasks.html" >Tasks</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.13</td>
            <td class="title-cell"><a href="builds.html" >Builds</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.14</td>
            <td class="title-cell"><a href="how-to-guides.html" >How-To Guides</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15</td>
            <td class="title-cell"><a href="operation.html"  class="active">Operation</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.16</td>
            <td class="title-cell"><a href="observation.html" >Observation</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.17</td>
            <td class="title-cell"><a href="internals.html" >Internals</a></td>
          </tr>
        
        </table>
      </div>
    </nav>
  </div>
  

  

  
  <div class="context">
    <nav>
      <div class="top">
        <span class="section-number">1.15</span><a href="operation.html"  class="active">Operation</a>
      </div>

      <div class="children">
        <table>
        
          <tr>
            <td class="number-cell">1.15.1</td>
            <td class="title-cell"><a href="metrics.html" >Metrics</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.2</td>
            <td class="title-cell"><a href="tracing.html" >Tracing</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.3</td>
            <td class="title-cell"><a href="encryption.html" >Encryption</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.4</td>
            <td class="title-cell"><a href="creds.html"  class="active">Credential Management</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.5</td>
            <td class="title-cell"><a href="container-placement.html" >Container Placement</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.6</td>
            <td class="title-cell"><a href="opa.html" >Open Policy Agent Integration</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.7</td>
            <td class="title-cell"><a href="performance-tuning.html" >Performance Tuning</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.8</td>
            <td class="title-cell"><a href="global-resources.html" >Global Resources</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.9</td>
            <td class="title-cell"><a href="administration.html" >Administration</a></td>
          </tr>
        
        </table>
      </div>
    </nav>
  </div>
  

  

  
  <div class="context">
    <nav>
      <div class="top">
        <span class="section-number">1.15.4</span><a href="creds.html"  class="active">Credential Management</a>
      </div>

      <div class="children">
        <table>
        
          <tr>
            <td class="number-cell">1.15.4.1</td>
            <td class="title-cell"><a href="vault-credential-manager.html" >The Vault credential manager</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.4.2</td>
            <td class="title-cell"><a href="credhub-credential-manager.html" >The CredHub credential manager</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.4.3</td>
            <td class="title-cell"><a href="aws-ssm-credential-manager.html"  class="self">The AWS SSM credential manager</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.4.4</td>
            <td class="title-cell"><a href="aws-asm-credential-manager.html" >The AWS Secrets Manager credential manager</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.4.5</td>
            <td class="title-cell"><a href="kubernetes-credential-manager.html" >Kubernetes Credential Manager</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.4.6</td>
            <td class="title-cell"><a href="conjur-credential-manager.html" >The Conjur credential manager</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.4.7</td>
            <td class="title-cell"><a href="creds-caching.html" >Caching credentials</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.4.8</td>
            <td class="title-cell"><a href="creds-redacting.html" >Redacting credentials</a></td>
          </tr>
        
          <tr>
            <td class="number-cell">1.15.4.9</td>
            <td class="title-cell"><a href="creds-retry-logic.html" >Retrying failed fetches</a></td>
          </tr>
        
        </table>
      </div>
    </nav>
  </div>
  

  

  



<div class="context">
  <div class="Top">
    On this page:
  </div>

  <div class="children anchors">
    <table>
      

      
  
    
      <tr>
        <td class="number-cell">1.15.4.3.1</td>
        <td class="title-cell"><a href="aws-ssm-credential-manager.html#configuration" >Configuration</a></td>
      </tr>
      
        <tr>
          <td class="number-cell"><code>#</code></td>
          <td class="title-cell"><a href="aws-ssm-credential-manager.html#aws-ssm-access-key"><strong><code>aws-ssm-access-key</code></strong></a></td>
        </tr>
      
        <tr>
          <td class="number-cell"><code>#</code></td>
          <td class="title-cell"><a href="aws-ssm-credential-manager.html#aws-ssm-secret-key"><strong><code>aws-ssm-secret-key</code></strong></a></td>
        </tr>
      
        <tr>
          <td class="number-cell"><code>#</code></td>
          <td class="title-cell"><a href="aws-ssm-credential-manager.html#aws-ssm-session-token"><strong><code>aws-ssm-session-token</code></strong></a></td>
        </tr>
      
        <tr>
          <td class="number-cell"><code>#</code></td>
          <td class="title-cell"><a href="aws-ssm-credential-manager.html#aws-ssm-region"><strong><code>aws-ssm-region</code></strong></a></td>
        </tr>
      
        <tr>
          <td class="number-cell"><code>#</code></td>
          <td class="title-cell"><a href="aws-ssm-credential-manager.html#aws-ssm-pipeline-secret-template"><strong><code>aws-ssm-pipeline-secret-template</code></strong></a></td>
        </tr>
      
        <tr>
          <td class="number-cell"><code>#</code></td>
          <td class="title-cell"><a href="aws-ssm-credential-manager.html#aws-ssm-team-secret-template"><strong><code>aws-ssm-team-secret-template</code></strong></a></td>
        </tr>
      
      
  
    
  

    
      <tr>
        <td class="number-cell">1.15.4.3.2</td>
        <td class="title-cell"><a href="aws-ssm-credential-manager.html#iam-permissions" >IAM Permissions</a></td>
      </tr>
      
      
  
    
  

    
      <tr>
        <td class="number-cell">1.15.4.3.3</td>
        <td class="title-cell"><a href="aws-ssm-credential-manager.html#credential-lookup-rules" >Credential Lookup Rules</a></td>
      </tr>
      
      
  
    
  

    
  

    </table>
  </div>
</div>

      </div>

      <div class="body-content">
        <div class="page-content">
          <div class="section" id="section_aws-ssm-credential-manager">
  
  <h1 class="section-header"><a class="anchor-target" name="aws-ssm-credential-manager" href="#aws-ssm-credential-manager"></a><span class="section-number">1.15.4.3 </span>The AWS SSM credential manager</h1>
  

  

  
    
      <div class="section" id="section_configuration">
  
  <h2 class="section-header"><a class="anchor-target" name="configuration" href="#configuration"></a>Configuration</h2>
  

  <p>The ATC is configured with an access key and secret key or session token and the AWS region that your parameters are stored within. If no access key, secret key, or session token is provided, Concourse will attempt to use environment variables or the instance credentials assigned to the instance.</p><p>The ATC&#39;s configuration specifies the following:</p><div class="definition">
  <div class="definition-thumb">
    <a id="aws-ssm-access-key"></a>
    <pre><a href="aws-ssm-credential-manager.html#aws-ssm-access-key"><strong>aws-ssm-access-key</strong></a>: string</pre>
  </div>

  <div class="definition-content">
    <p>A valid AWS access key.</p><p>Environment variable <code>CONCOURSE_AWS_SSM_ACCESS_KEY</code>.</p>
  </div>
</div><div class="definition">
  <div class="definition-thumb">
    <a id="aws-ssm-secret-key"></a>
    <pre><a href="aws-ssm-credential-manager.html#aws-ssm-secret-key"><strong>aws-ssm-secret-key</strong></a>: string</pre>
  </div>

  <div class="definition-content">
    <p>The secret key that corresponds to the access key defined above.</p><p>Environment variable <code>CONCOURSE_AWS_SSM_SECRET_KEY</code>.</p>
  </div>
</div><div class="definition">
  <div class="definition-thumb">
    <a id="aws-ssm-session-token"></a>
    <pre><a href="aws-ssm-credential-manager.html#aws-ssm-session-token"><strong>aws-ssm-session-token</strong></a>: string</pre>
  </div>

  <div class="definition-content">
    <p>A valid AWS session token.</p><p>Environment variable <code>CONCOURSE_AWS_SSM_SESSION_TOKEN</code>.</p>
  </div>
</div><div class="definition">
  <div class="definition-thumb">
    <a id="aws-ssm-region"></a>
    <pre><a href="aws-ssm-credential-manager.html#aws-ssm-region"><strong>aws-ssm-region</strong></a>: string</pre>
  </div>

  <div class="definition-content">
    <p>The AWS region that requests to parameter store will be sent to.</p><p>Environment variable <code>CONCOURSE_AWS_SSM_REGION</code>.</p>
  </div>
</div><div class="definition">
  <div class="definition-thumb">
    <a id="aws-ssm-pipeline-secret-template"></a>
    <pre><a href="aws-ssm-credential-manager.html#aws-ssm-pipeline-secret-template"><strong>aws-ssm-pipeline-secret-template</strong></a>: string</pre>
  </div>

  <div class="definition-content">
    <p>The base path used when attempting to locate a pipeline-level secret.</p><p>Environment variable <code>CONCOURSE_AWS_SSM_PIPELINE_SECRET_TEMPLATE</code>.</p><p>Example:</p><p>Default: <code>/concourse/{{.Team}}/{{.Pipeline}}/{{.Secret}}</code></p>
  </div>
</div><div class="definition">
  <div class="definition-thumb">
    <a id="aws-ssm-team-secret-template"></a>
    <pre><a href="aws-ssm-credential-manager.html#aws-ssm-team-secret-template"><strong>aws-ssm-team-secret-template</strong></a>: string</pre>
  </div>

  <div class="definition-content">
    <p>The base path used when attempting to locate a team-level secret.</p><p>Environment variable <code>CONCOURSE_AWS_SSM_TEAM_SECRET_TEMPLATE</code>.</p><p>Example:</p><p>Default: <code>/concourse/{{.Team}}/{{.Secret}}</code></p>
  </div>
</div><p>For example, to launch the ATC and enable the parameter store, you may configure:</p><pre><code class="language-bash">concourse web ... \
  --aws-ssm-region us-east-1 \
  --aws-ssm-access-key AKIAIOSFODNN7EXAMPLE \
  --aws-ssm-secret-key wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY

# or use env variables
CONCOURSE_AWS_SSM_REGION=&#34;us-east-1&#34; \
CONCOURSE_AWS_SSM_ACCESS_KEY=&#34;AKIAIOSFODNN7EXAMPLE&#34; \
CONCOURSE_AWS_SSM_SECRET_KEY=&#34;wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY&#34; \
concourse web ...</code></pre><p>A more secure method is to configure an <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html">IAM role</a> for your EC2 ATC instance so that credentials are fetched automatically from the EC2 metadata service.</p>

  
    
  
</div>
    
      <div class="section" id="section_iam-permissions">
  
  <h2 class="section-header"><a class="anchor-target" name="iam-permissions" href="#iam-permissions"></a>IAM Permissions</h2>
  

  <p>The following is an example of an IAM policy that can be used to grant permissions to an IAM user or instance role. Note that the <code>Resource</code> section can contain a wildcard to a parameter or be restricted to an individual parameter.</p><pre><code class="language-json">{
&#34;Version&#34;: &#34;2012-10-17&#34;,
&#34;Statement&#34;: [
    {
        &#34;Sid&#34;: &#34;AllowAccessToSsmParameters&#34;,
        &#34;Effect&#34;: &#34;Allow&#34;,
        &#34;Action&#34;: [
            &#34;ssm:GetParameter&#34;,
            &#34;ssm:GetParametersByPath&#34;
        ],
        &#34;Resource&#34;: [
            &#34;arn:aws:ssm:::parameter/concourse/*&#34;,
            &#34;arn:aws:ssm:::parameter/concourse/TEAM_NAME/*&#34;,
            &#34;arn:aws:ssm:::parameter/concourse/TEAM_NAME/PIPELINE_NAME/*&#34;
        ]
    },
    {
        &#34;Sid&#34;: &#34;AllowAccessToDecryptSsmParameters&#34;,
        &#34;Effect&#34;: &#34;Allow&#34;,
        &#34;Action&#34;: [
            &#34;kms:Decrypt&#34;,
            &#34;kms:DescribeKey&#34;
        ],
        &#34;Resource&#34;: &#34;arn:aws:kms:::key/KMS_KEY_ID&#34;
    },
    {
        &#34;Sid&#34;: &#34;AllowListKeys&#34;,
        &#34;Effect&#34;: &#34;Allow&#34;,
        &#34;Action&#34;: [
            &#34;kms:ListAliases&#34;,
            &#34;kms:ListKeys&#34;
        ],
        &#34;Resource&#34;: &#34;*&#34;
    }
]
}</code></pre><p>Note that the <code>TEAM_NAME</code>, <code>PIPELINE_NAME</code>, and <code>KMS_KEY_ID</code> text above should be replaced to fit your Concourse setup.</p><p>For more information on how to use IAM roles to restrict access to SSM parameters, review the <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-paramstore-access.html">official documentation</a>.</p>

  
    
  
</div>
    
      <div class="section" id="section_credential-lookup-rules">
  
  <h2 class="section-header"><a class="anchor-target" name="credential-lookup-rules" href="#credential-lookup-rules"></a>Credential Lookup Rules</h2>
  

  <p>When resolving a parameter such as <code>((foo_param))</code>, Concourse will look in the following paths, in order:</p><ul>

  <li><pre><code class="language-">/concourse/TEAM_NAME/PIPELINE_NAME/foo_param</code></pre></li>

  <li><pre><code class="language-">/concourse/TEAM_NAME/foo_param</code></pre></li>

</ul><p>The leading <code>/concourse</code> can be changed by specifying <code>--aws-ssm-pipeline-secret-template</code> or <code>--aws-ssm-team-secret-template</code> variables.</p>

  
    
  
</div>
    
  
</div>

          <nav class="prev-next">
          
            <div class="prev">
              prev:

              
              <span class="section-number">1.15.4.2</span>
              

              <a href="credhub-credential-manager.html">The CredHub credential manager</a>
            </div>
          

          
            <div class="next">
              next:

              
              <span class="section-number">1.15.4.4</span>
              

              <a href="aws-asm-credential-manager.html">The AWS Secrets Manager credential manager</a>
            </div>
          
          </nav>
        </div>

        <div class="page-aside"></div>
      </div>
    </div>

    <ul class="improve-docs">
      <li><img src="images/icons/github-box.svg" /> <a href="https://github.com/concourse/docs">help improve this site</a></li>
      <li><img src="images/booklit.svg" /> powered by <a href="https://vito.github.io/booklit">Booklit</a></li>
    </ul>
  </body>
</html>